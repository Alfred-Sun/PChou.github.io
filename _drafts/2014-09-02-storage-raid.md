---
layout: postlayout
title: 存储技术之磁盘工作原理
categories: [hardware]
tags: [Hardware,storage,disk]
---

存储技术如今已经越来越重要，而且在云计算时代，涌现出了很多专注于云存储的厂商。存储技术本身也十分复杂，从硬件到协议到软件到接口几乎覆盖计算机科学的方方面面。笔者借助《大话存储II》这本书，开始了这块知识空白的补充。本文的图片均来源于网络。


## RAID

一块磁盘的容量有限，速度有限，如果需要更大的存储空间，更快的速度怎么办呢？而且如果数据可靠性要求很高，如果一块磁盘坏了，是否有办法保持数据不丢失呢？`RAID`因此而出。无论是哪种RAID，其的基本思想不外乎如下几种：

- 如果一块硬盘不够用，那么多加几块
- 如果一块硬盘不够快，那么让多块硬盘同时参与IO
- 如果要考虑硬盘损坏，那么让数据多存几份，或者利用某种校验算法，保证数据能够恢复


### RAID 0

`RAID 0`将两块/多块硬盘合并成一块逻辑磁盘。比如两块500GB的硬盘组建RAID 0，那么在系统中我们可以看到有一块1TB的逻辑磁盘，而并不能看到是两块物理硬盘。RAID 0将数据的读写同时分摊到多块磁盘上，也就是说，数据会被控制器分割后写入多块盘，读取时也会同时调动多块盘一起读，最后由控制器组合后返回上层操作系统。

![](http://img5.pcpop.com/ArticleImages/0x0/0/755/000755924.jpg)

可以看出RAID 0在读写效率上要比单盘要高，因为有很大概率调动多块磁盘同时操作。对于上层操作系统而言，并不感知。操作系统只是觉得可用的扇区变多了，而且对于数据被“分割”和“合并”这样的事情也一无所知。

- 优点：速度快、效率高、容量提升
- 缺点：无备份，容易丢失数据


### RAID 1

为了解决磁盘损坏导致所有数据丢失，`RAID 1`将数据原样复制了一份到另一个磁盘，这样能够在一块盘损坏的情况下，保留数据。而且读数据的时候可以同时在两块盘上读，速度提升了，因为它们的数据是完全一样的。

![](http://img5.pcpop.com/ArticleImages/0x0/0/755/000755925.jpg)

- 优点：读速度快，有备份
- 缺点：容量无提升，写效率低

### RAID 2

`RAID 2`最初是希望在RAID 0中加入RAID 1的可靠性。原理是将数据打散成bit，平均存到不同的磁盘上，并利用[Hanmming Code](http://zh.wikipedia.org/zh-cn/%E6%B1%89%E6%98%8E%E7%A0%81)算法将校验位写入到校验盘，在读取数据时反过来校验数据。如果某块磁盘损坏，可以通过校验得到原本坏盘上的数据。汉明码需要比较多的校验盘，如果数据盘有4块，校验盘需要3块； 如果数据盘有7块，校验盘需要4块。RAID 2最少需要3块硬盘才能组建。

- 优点：在RAID 0的基础上加入校验功能
- 缺点：校验盘太多

### RAID 3

针对RAID 2校验盘太多的情况，利用更为简单的异或运算，创建了RAID 3。RAID 3的思想也是将数据大三存在不同的数据盘上，并将校验位单独存放在校验盘，但是无论数据盘有多少，RAID 3的校验盘只需要一块，因为RAID 3是将数据位进行异或运算得到的校验位。不过这样做只能容许一块数据盘的损坏，在得知那块盘损坏的情况下，可以根据校验盘和其他的数据盘计算出损坏的盘上的数据。

- 优点：在RAID 2的基础上，减少了校验盘的数量，并行度也有所提高
- 缺点：无法并发IO，因为每次IO都需要牵动所有的磁盘，当然RAID 2也有此缺点

### RAID 4

